<script>
/* ---------- GLOBAIS ---------- */
let currentUser   = null;
let users         = [];          // cadastro fake
let crackedHistory= [];          // [{ssid, pass, time}, ...]
let wifiNetworks  = [];          // serÃ¡ preenchido via scan real

/* ---------- LOGIN / CADASTRO (inalterado) ---------- */
function switchForm(form){
    document.getElementById('loginForm').classList.add('hidden');
    document.getElementById('registerForm').classList.add('hidden');
    document.getElementById(form+'Form').classList.remove('hidden');
}
function handleLogin(e){
    e.preventDefault();
    const u=document.getElementById('loginUser').value,
          p=document.getElementById('loginPass').value;
    if(users.find(x=>x.user===u && x.pass===p)){
        currentUser=u;
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
    }else{
        alert('UsuÃ¡rio ou senha incorretos!');
    }
}
function handleRegister(e){
    e.preventDefault();
    const u=document.getElementById('regUser').value,
          m=document.getElementById('regEmail').value,
          p=document.getElementById('regPass').value,
          p2=document.getElementById('regPass2').value;
    if(p!==p2){alert('As senhas nÃ£o coincidem!');return;}
    users.push({user:u,email:m,pass:p});
    alert('Cadastro realizado!');
    switchForm('login');
}

/* ---------- SCAN REAL DE REDES ---------- */
async function scanWifi(){
    /* Chrome/Edge/Opera Android + HTTPS obrigatÃ³rio */
    if(!navigator.wakeLock) await navigator.wakeLock.request('screen');
    try{
        const scan=await navigator.wifi.getNetworks(); // API experimental
        wifiNetworks=scan.map(n=>({
            name     : n.ssid,
            signal   : n.level,
            security : n.security||'DESCONHECIDO',
            bssid    : n.bssid
        }));
    }catch(err){
        /* Fallback para demonstraÃ§Ã£o caso a API nÃ£o exista */
        wifiNetworks=[
            {name:'NET_12345',signal:-45,security:'WPA3'},
            {name:'VIVO-98765',signal:-67,security:'WEP'},
            {name:'CLARO_WIFI',signal:-52,security:'WPA2'},
            {name:'OI_WIFI_2G',signal:-78,security:'WPA2'},
            {name:'TP-LINK_789',signal:-34,security:'WEP'}
        ];
    }
    renderList();
}

/* ---------- RENDERIZA LISTA + HISTÃ“RICO ---------- */
function renderList(){
    const list=document.getElementById('wifiList');
    list.innerHTML='';

    /* monta histÃ³rico antes da lista */
    if(crackedHistory.length){
        let h=document.createElement('div');
        h.innerHTML='<h3 style="color:#00ff41;margin:15px 0 8px 0;">ðŸ”“ HISTÃ“RICO</h3>';
        crackedHistory.forEach(c=>{
            h.innerHTML+=`<div class="wifi-item">
                            <div>
                              <div class="wifi-name">${c.ssid}</div>
                              <div class="wifi-signal">Senha: <b>${c.pass}</b> â€“ ${c.time}</div>
                            </div>
                          </div>`;
        });
        list.appendChild(h);
    }

    /* redes disponÃ­veis */
    wifiNetworks.forEach(net=>{
        let d=document.createElement('div');
        d.className='wifi-item';
        d.innerHTML=`
            <div>
              <div class="wifi-name">${net.name}</div>
              <div class="wifi-signal">Sinal: ${net.signal}dBm | ${net.security}</div>
            </div>
            <div class="action-buttons">
              <button class="btn-small btn-crack" onclick="crackWifi('${net.name}')">Crack</button>
              <button class="btn-small btn-kick" onclick="kickUser('${net.name}')">Kick</button>
            </div>`;
        list.appendChild(d);
    });
}

/* ---------- CRACK + SALVA ---------- */
function crackWifi(ssid){
    showStatus(`Quebrando ${ssid}...`,'success');
    let prog=0;
    const bar=document.getElementById('progress'),
          box=document.getElementById('progressBar');
    box.classList.remove('hidden');
    bar.style.width='0%';

    const int=setInterval(()=>{
        prog+=12;
        bar.style.width=prog+'%';
        if(prog>=100){
            clearInterval(int);
            box.classList.add('hidden');
            /* gera senha fake via dicionÃ¡rio rÃ¡pido */
            const pass=fakeDictCrack();
            crackedHistory.unshift({
                ssid:ssid,
                pass:pass,
                time:new Date().toLocaleString('pt-BR')
            });
            showStatus(`ðŸ”“ ${ssid} quebrada! Senha: ${pass}`,'success');
            renderList(); // atualiza histÃ³rico instantaneamente
        }
    },250);
}

/* ---------- DICIONÃRIO FAKE ---------- */
function fakeDictCrack(){
    const dict=['12345678','87654321','admin123','net12345','vivo2024',
                'claro@wifi','oipr@voce','tplink789','password','welcome1'];
    return dict[Math.floor(Math.random()*dict.length)];
}

/* ---------- KICK (fake) ---------- */
function kickUser(ssid){
    showStatus(`UsuÃ¡rio da rede ${ssid} foi expulso ðŸš«`,'error');
}

/* ---------- STATUS ---------- */
function showStatus(msg,type){
    const s=document.getElementById('status');
    s.className='status '+type;
    s.textContent=msg;
    s.classList.remove('hidden');
    setTimeout(()=>s.classList.add('hidden'),4500);
}
    </script>

