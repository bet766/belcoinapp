<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Belcoin - Banco Digital</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #111;
      color: white;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 500px;
      margin: auto;
      padding: 20px;
    }
    .card {
      background: #1c1c1c;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      margin-top: 30px;
    }
    h2, h3 {
      color: #00e676;
    }
    input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: none;
      border-radius: 8px;
      background: #2a2a2a;
      color: white;
    }
    button {
      width: 100%;
      padding: 12px;
      background: #00c853;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    .link {
      color: #00e676;
      cursor: pointer;
      text-align: center;
      margin-top: 15px;
    }
    .hidden { display: none; }
    .extrato {
      background: #292929;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="container">

    <div class="card" id="loginCard">
      <h2>Bem-vindo à <strong>Belcoin</strong></h2>
      <input type="email" id="loginEmail" placeholder="Email" />
      <input type="password" id="loginPassword" placeholder="Senha" />
      <button onclick="login()">Entrar</button>
      <div class="link" onclick="toggleCards()">Criar conta</div>
    </div>

    <div class="card hidden" id="registerCard">
      <h2>Criar conta na Belcoin</h2>
      <input type="text" id="regNome" placeholder="Nome completo" />
      <input type="email" id="regEmail" placeholder="Email" />
      <input type="password" id="regSenha" placeholder="Senha" />
      <input type="text" id="regTelefone" placeholder="Telefone" />
      <input type="text" id="regCPF" placeholder="CPF" />
      <button onclick="register()">Cadastrar</button>
      <div class="link" onclick="toggleCards()">Já tem conta? Entrar</div>
    </div>

    <div class="card hidden" id="appCard">
      <h2 id="welcomeText">Olá, usuário</h2>
      <p><strong>Saldo:</strong> R$ <span id="saldo">0,00</span></p>

      <h3>Depositar</h3>
      <input type="number" id="valorDeposito" placeholder="Digite o valor" />
      <button onclick="depositar()">Confirmar Depósito</button>

      <h3>Saque</h3>
      <input type="number" id="valorSaque" placeholder="Valor para saque" />
      <button onclick="sacar()">Solicitar Saque</button>

      <h3>Transferir para outro usuário (CPF)</h3>
      <input type="text" id="cpfDestino" placeholder="CPF do destinatário" />
      <div id="nomeDestinatario" style="margin: 8px 0;"></div>
      <input type="number" id="valorTransferencia" placeholder="Valor a transferir" />
      <button onclick="transferir()">Transferir</button>

      <h3>Extrato</h3>
      <div id="extratoContainer"></div>

      <button onclick="logout()" style="margin-top: 20px;">Sair da conta</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_DOMINIO.firebaseapp.com",
      databaseURL: "https://SEU_DOMINIO.firebaseio.com",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_BUCKET.appspot.com",
      messagingSenderId: "SEU_ID",
      appId: "SEU_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    let currentUID = null;

    function toggleCards() {
      loginCard.classList.toggle("hidden");
      registerCard.classList.toggle("hidden");
    }

    function register() {
      const nome = regNome.value;
      const email = regEmail.value;
      const senha = regSenha.value;
      const telefone = regTelefone.value;
      const cpf = regCPF.value;

      auth.createUserWithEmailAndPassword(email, senha)
        .then(cred => {
          const uid = cred.user.uid;
          return db.ref("usuarios/" + uid).set({
            nome, email, telefone, cpf,
            saldo: 0,
            extrato: [],
            ultimoRendimento: Date.now()
          });
        })
        .then(() => {
          alert("Cadastro concluído com sucesso!");
          toggleCards();
        })
        .catch(err => alert("Erro: " + err.message));
    }

    function login() {
      auth.signInWithEmailAndPassword(loginEmail.value, loginPassword.value)
        .then(cred => {
          currentUID = cred.user.uid;
          carregarPainel();
        })
        .catch(err => alert("Erro ao entrar: " + err.message));
    }

    function carregarPainel() {
      db.ref("usuarios/" + currentUID).once("value")
        .then(snapshot => {
          const user = snapshot.val();
          welcomeText.innerText = "Olá, " + user.nome;
          saldo.innerText = user.saldo.toFixed(2);
          gerarRendimento(user);
          mostrarExtrato(user.extrato || []);
          loginCard.classList.add("hidden");
          appCard.classList.remove("hidden");
        });
    }

    function gerarRendimento(user) {
      const agora = Date.now();
      const ultima = user.ultimoRendimento || agora;
      const horas = (agora - ultima) / (1000 * 60 * 60);
      if (horas >= 24) {
        const rendimento = user.saldo * 0.0005;
        const novoSaldo = user.saldo + rendimento;
        const extrato = user.extrato || [];
        extrato.push({ tipo: "rendimento", valor: rendimento, data: agora });
        db.ref("usuarios/" + currentUID).update({
          saldo: novoSaldo,
          extrato,
          ultimoRendimento: agora
        });
        saldo.innerText = novoSaldo.toFixed(2);
        mostrarExtrato(extrato);
      }
    }

    function depositar() {
      const valor = parseFloat(valorDeposito.value);
      if (!valor || valor <= 0) return alert("Valor inválido");
      db.ref("usuarios/" + currentUID).once("value")
        .then(snapshot => {
          const user = snapshot.val();
          const novoSaldo = user.saldo + valor;
          const extrato = user.extrato || [];
          extrato.push({ tipo: "depósito", valor, data: Date.now() });
          return db.ref("usuarios/" + currentUID).update({ saldo: novoSaldo, extrato });
        })
        .then(() => {
          alert("Depósito feito com sucesso!");
          carregarPainel();
        });
    }

    function sacar() {
      const valor = parseFloat(valorSaque.value);
      if (!valor || valor <= 0) return alert("Valor inválido");
      db.ref("usuarios/" + currentUID).once("value")
        .then(snapshot => {
          const user = snapshot.val();
          if (user.saldo < valor) return alert("Saldo insuficiente");
          const novoSaldo = user.saldo - valor;
          const extrato = user.extrato || [];
          extrato.push({ tipo: "saque", valor, data: Date.now() });
          return db.ref("usuarios/" + currentUID).update({ saldo: novoSaldo, extrato });
        })
        .then(() => {
          alert("Saque solicitado!");
          carregarPainel();
        });
    }

    function transferir() {
      const cpf = cpfDestino.value;
      const valor = parseFloat(valorTransferencia.value);
      if (!cpf || !valor || valor <= 0) return alert("Preencha corretamente.");

      db.ref("usuarios").once("value")
        .then(snapshot => {
          let uidDestino = null, nomeDest = "";
          snapshot.forEach(child => {
            const u = child.val();
            if (u.cpf === cpf) {
              uidDestino = child.key;
              nomeDest = u.nome;
            }
          });

          if (!uidDestino) return alert("Usuário não encontrado.");

          if (!confirm("Deseja transferir R$ " + valor.toFixed(2) + " para " + nomeDest + "?")) return;

          return Promise.all([
            db.ref("usuarios/" + currentUID).once("value"),
            db.ref("usuarios/" + uidDestino).once("value")
          ]).then(([snapFrom, snapTo]) => {
            const de = snapFrom.val();
            const para = snapTo.val();

            if (de.saldo < valor) return alert("Saldo insuficiente");

            de.saldo -= valor;
            para.saldo += valor;
            de.extrato = de.extrato || [];
            para.extrato = para.extrato || [];

            de.extrato.push({ tipo: "transferência enviada", valor, data: Date.now(), para: nomeDest });
            para.extrato.push({ tipo: "transferência recebida", valor, data: Date.now(), de: de.nome });

            return Promise.all([
              db.ref("usuarios/" + currentUID).update({ saldo: de.saldo, extrato: de.extrato }),
              db.ref("usuarios/" + uidDestino).update({ saldo: para.saldo, extrato: para.extrato })
            ]).then(() => {
              alert("Transferência realizada!");
              carregarPainel();
            });
          });
        });
    }

    function mostrarExtrato(lista) {
      const container = extratoContainer;
      container.innerHTML = "";
      lista.reverse().forEach(item => {
        const data = new Date(item.data).toLocaleString();
        const msg = item.tipo.toUpperCase() + ": R$ " + item.valor.toFixed(2);
        const extra = item.para ? " → " + item.para : item.de ? " ← " + item.de : "";
        const div = document.createElement("div");
        div.className = "extrato";
        div.innerText = `[${data}] ${msg}${extra}`;
        container.appendChild(div);
      });
    }

    function logout() {
      auth.signOut().then(() => location.reload());
    }
  </script>
</body>
</html>
